# PLAN.md（本地单模式重构）

## 已完成

1. 后端能力收敛
- 删除云端托管播放链路，`/media/:videoId` 返回 `410`。
- 删除任务相关接口与轮询模型。
- 删除存储状态接口。
- 建房固定 `room_mode=local_file`，不再要求前端传模式。

2. 上传链路重构
- `POST /api/videos` 改为同步登记，直接返回 `video`。
- 必填 `contentHash`（前端计算），可选 `cover`。
- 复用 hash 时返回已有记录；可更新封面。

3. 房间与同步
- socket 门禁固定为本地模式逻辑。
- `local-file-required / local-file-verified / playback-denied` 全链路保留。
- 续播、漂移校正、连播倒计时保持可用。

4. 前端页面改造
- 上传页：移除模式选择、移除任务轮询、移除存储状态。
- 上传页新增：中段随机抽帧封面上传。
- 视频/列表页：移除模式选择，统一本地模式文案。
- 视频详情页：移除云端预览，展示封面与元信息。
- 管理页：只保留 Root 房间管理。
- 房间页：删除云端分支，仅保留本地文件播放路径。

5. 文档与部署
- 更新 `README.md`、`Require.md`、`.env.example`。
- 部署脚本改为创建 `covers/` 目录，不再创建播放池目录。

## 验收要点

- [ ] 未登录访问业务 API 返回 401。
- [ ] 首个注册用户为 Root。
- [ ] 上传页提交后直接返回成功/失败，不再出现任务轮询。
- [ ] 视频记录仅本地模式，不存在云端播放入口。
- [ ] 建房不需要模式选择，进入房间后需要当前集 hash 校验。
- [ ] 管理页不展示存储状态与任务记录，仅展示房间管理。
