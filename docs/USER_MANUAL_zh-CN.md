# 一起看服务用户使用手册

## 1. 产品简介

一起看服务是一个基于“本地文件 + hash 匹配”的多人同步观影系统：

- 服务端不保存视频源文件，只保存元数据（标题、hash、封面、进度等）。
- 每位成员都在自己电脑上选择本地视频文件播放。
- 只有本地文件 hash 与房间剧集一致，才能加入房间并参与同步。

## 2. 适用对象与使用前提

本文档面向日常使用系统的成员（观影用户/房主/管理员用户）。

使用前提：

- 服务已由管理员部署完成。
- 你已拿到访问地址（例如 `http://服务器IP:3000`）。
- 你本地有可播放的视频文件。

## 3. 角色与权限

- `user`：普通用户，可上传视频、创建列表、创建/删除自己创建的放映室、加入放映室。
- `root`：管理员，拥有 `user` 全部权限，另外可删除任意视频、任意视频列表、任意放映室。
- 系统中**第一个注册的账号会自动成为 `root`**。

## 4. 快速上手

### 4.1 注册与登录

1. 打开首页 `/`。
2. 新用户在“注册”区创建账号；已有账号直接登录。
3. 注册用户名要求：`3-32` 位，只能使用小写字母、数字、下划线。

### 4.2 登记视频（上传页）

页面：`/upload`

1. 选择本地视频文件。
2. 可填写标题、描述（可选）。
3. 点击“提交登记”。

系统会自动：

- 在浏览器端计算 SHA-256（会显示进度）。
- 尝试抽取一帧作为封面（失败也不影响登记）。
- 只上传元数据，不上传视频源文件。
- 如果 hash 已存在，会自动复用已登记视频。

### 4.3 创建视频列表（多集）

页面：`/playlists/create`

1. 填写列表名称（必填）。
2. 从左侧视频库添加剧集到右侧。
3. 通过“上移/下移”调整集顺序。
4. 点击“创建视频列表”。

### 4.4 创建放映室

可从两处创建：

- 视频页 `/videos` 或视频详情页 `/videos/:videoId`：创建单视频放映室
- 列表页 `/playlists`：创建多集放映室，并可选起播集

### 4.5 加入放映室并开始同步

页面：`/rooms/:roomId`

1. 点击“选择文件并校验”，选择你本地的对应视频文件（多集可多选）。
2. 等待校验完成，右侧状态显示“全部剧集已校验”。
3. 点击“加入”进入房间。
4. 加入后可进行播放/暂停/拖动/切集/倍速，同步会广播给房间成员。

## 5. 放映室功能说明

### 5.1 同步播放

- 同步动作：播放、暂停、拖拽、倍速、切换剧集。
- 系统会自动进行漂移校正，尽量保持多人时间轴一致。
- 房间进度会持久化（当前集、当前时间、倍速、观看累计时长）。

### 5.2 自动下一集

- 多集场景下，当前集接近结束会出现自动下一集倒计时。
- 可点击“取消自动下一集”。

### 5.3 聊天与音视频

- 左栏支持聊天、成员列表、视频墙。
- 可单独开启/关闭摄像头和麦克风。
- 若设备权限失败，可继续使用聊天和同步播放。

## 6. 管理台（仅 Root 账号）

页面：`/admin`（仅 `root` 可访问）

可进行：

- 删除任意视频
- 删除任意视频列表
- 删除任意放映室

注意：删除视频或视频列表时，关联放映室会被关闭。

## 7. 支持格式

视频扩展名：

- `.mp4`
- `.webm`
- `.ogg`
- `.ogv`
- `.m4v`
- `.mov`
- `.mkv`
- `.avi`
- `.ts`

封面格式：

- `image/jpeg`
- `image/png`
- `image/webp`

## 8. 常见问题

### 8.1 “加入”按钮灰色不可点

原因：还没完成全部剧集校验。  
处理：重新点击“选择文件并校验”，补齐缺失剧集，直到显示“全部剧集已校验”。

### 8.2 提示“不支持该视频格式”

原因：文件扩展名或 MIME 不在支持列表中。  
处理：更换为支持格式，或先转码后再登记。

### 8.3 摄像头/麦克风打开失败

原因：浏览器权限被拒绝或设备不可用。  
处理：检查浏览器权限和系统设备设置；即使失败，仍可进行聊天与同步播放。

### 8.4 无法访问管理台

原因：当前账号不是 `root`。  
处理：使用首个注册账号登录，或由 `root` 账号执行管理操作。
